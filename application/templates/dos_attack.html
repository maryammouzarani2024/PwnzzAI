<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM DoS Simulation - Pwnzza Shop</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    
    {% include 'navbar.html' %}

    <main class="container">
        <h1>LLM DoS Attack</h1>
        
        <div class="insecure-plugin-content">
            <details class="description-dropdown">
                <summary class="dropdown-title">Description</summary>
                <div class="dropdown-content">
                    <section class="section-box">
                        
                    <p><strong>Denial-of-Service (DoS) vulnerabilities in large language models (LLMs)</strong> can be exploited through malicious prompt patterns or high-volume queries designed to exhaust system resources. Attackers may deliberately craft inputs that force the model to generate extremely long responses or perform complex reasoning steps, consuming a significant number of tokens and processing time. In pay-per-token or pay-per-request models, such behavior can rapidly burn through API rate limits or usage credits, leading to financial loss for either the user or the service provider. In more aggressive scenarios, attackers may trigger high-cost operations repeatedly to drain billing quotas or degrade service availability.</p>

                        <p>Beyond financial impact, these attacks can overwhelm server resources—such as CPU, memory, or network bandwidth—resulting in service degradation for other users. Legitimate users may experience delayed responses or total unavailability, especially in shared or production environments that rely on consistent uptime and performance. Addressing these threats requires implementing safeguards such as token limits, rate limiting, request validation, and real-time anomaly detection.</p>

                        <h3>Example Prompts That May Be Used in DoS-Style Attacks</h3>
                        <ul>
                            <li><code>Tell me every prime number between 1 and 1,000,000.</code></li>
                            <li><code>Repeat this sentence 10,000 times: "What is the meaning of recursion?"</code></li>
                            <li><code>Evaluate this logical expression step-by-step:<br>
                            (((A AND B) OR (NOT C)) AND ((D OR E) AND (F IMPLIES G))) with all possible combinations of truth values.</code></li>
                            <li><code>Simulate a chess game from this position and give commentary for each move.</code></li>
                        </ul>
                    </section>
                </div>
            </details>
            
            <details class="description-dropdown" open>
                <summary class="dropdown-title">Demonstration</summary>
                <div class="dropdown-content">
                    <section class="section-box">
                        <div style="display: flex; align-items: flex-start; margin: 40px auto 25px auto;">
                        <div style="flex: 1;">
                         
                        <p>This demo illustrates three different approaches to carrying out Denial of Service (DoS) attacks against LLM services:
                            <ol>
                            <li>An attack targeting OpenAI models.</li>

                            <li>An attack against free Ollama models.</li>

                            <li>A safe simulation that lets you experience the effects of a DoS attack without incurring costs or wasting energy.</li></p>
                            </ol>
                        <p><b>Warning:</b> Running real attacks on OpenAI API models will generate actual costs and may have real-world consequences. Use this feature responsibly and strictly for educational purposes only.</p>
   
                            </div>
                            <img style="width: 220px; height: auto; margin-left: 15px; flex-shrink: 0;" src="{{ url_for('static', filename='img/dos.png') }}" alt="DoS attack" class="demonstration-image">
                </div> 
                <!-- Main demo tabs -->
                <div class="model-tabs">
                    <div class="tab-headers">
                        <div class="tab-header active" data-tab="openai-model">OpenAI Model</div>
                        <div class="tab-header" data-tab="ollama-model">Free Model</div>
                        <div class="tab-header " data-tab="blenderbot-model">DoS Simulation </div>

                    </div>
                
                    <!-- OpenAI Tab Content -->
                    <div class="tab-content active" id="openai-model-tab">
                        <div class="model-implementation-section">
                            <div class="attack-section-container">
                                        <div class="warning-box">
                                            <h3><i class="fas fa-exclamation-triangle"></i> Warning</h3>
                                            <p>This demo will use your OpenAI API key to make real API calls. If you use the attack feature, you <strong>WILL</strong> be charged for all the API calls made during the attack. Use at your own risk and only for educational purposes.</p>
                                        </div>
                                        
                                        <!-- OpenAI Token Input Section -->
                                        <div class="token-section openai-token-section">
                                            <h3>Connect to OpenAI API</h3>
                                            <p>Enter your OpenAI API key to enable the real DoS attack demonstration:</p>
                                            <div class="token-input">
                                                <input type="password" id="openai-api-token" placeholder="Enter OpenAI API key...">
                                                <button id="connect-openai-api">Connect API</button>
                                            </div>
                                            <div id="openai-api-status" class="api-status disconnected">
                                                <i class="fas fa-circle-xmark"></i> Not connected to OpenAI API
                                            </div>
                                        </div>
                                        
                                        <!-- OpenAI Chat Interface -->
                                        <div class="chat-container">
                                            <div id="openai-chat-messages" class="chat-messages">
                                                <div class="message bot-message">
                                                    Hi! I'm the Pizza Assistant using OpenAI. I can help you with pizza recipes and information. Please connect your OpenAI API key first to start chatting.
                                                </div>
                                                <div class="message bot-message">
                                                    <strong>Try asking:</strong> "Generate a pizza recipe with pepperoni" or "Tell me about Italian pizzas"
                                                </div>
                                            </div>
                                            <div class="chat-input">
                                                <input type="text" id="openai-user-message" placeholder="Ask about pizza recipes..." disabled>
                                                <button id="openai-send-message" disabled>Send</button>
                                            </div>
                                        </div>
                                        
                                    </div>
                            </div>
                        </div>
                        </div>
                    </div>
               

                    <!-- Simulation Attack Section -->
                    <div class="tab-content " id="blenderbot-model-tab">
                        <div class="model-implementation-section">
                            <div class="attack-section-container">
                        
                                    <div class="dos-container">
                                        <h3>Chat with simulated LLM here</h3>
                                        <p>This interface is not connected to any model. It is a simulation to give you a sense of DoS attack.</p>
                            
                                    </div>                           
                                    <div class="attack-section">
                                        <h3>DoS Attack Simulation</h3>
                                        <p>Click the button below to simulate a DoS attack by sending a large number of requests to the LLM API.</p>
                                        
                                        <div class="attack-controls">
                                            <div class="attack-settings">
                                                <div class="form-group">
                                                    <label for="request-count">Number of Requests:</label>
                                                    <input type="number" id="request-count" class="form-control" value="50" min="1" max="500">
                                                </div>
                                                <div class="form-group">
                                                    <label for="prompt-template">Prompt Template:</label>
                                                    <textarea id="prompt-template" class="form-control" rows="3">Generate a detailed pizza recipe with the following toppings: {random_toppings}. Include cooking time and temperature.</textarea>
                                                </div>
                                            </div>
                                            
                                            <div class="attack-buttons">
                                                <button id="sim-attack-btn" class="btn btn-danger">
                                                    <i class="fas fa-bomb"></i> Launch DoS Attack
                                                </button>
                                                <button id="sim-stop-attack-btn" class="btn btn-secondary" disabled>
                                                    <i class="fas fa-stop-circle"></i> Stop Attack
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div id="sim-attack-progress" class="attack-progress" style="display: none;">
                                            <div class="progress-bar-container">
                                                <div id="sim-progress-bar" class="progress-bar"></div>
                                            </div>
                                            <div class="progress-stats">
                                                <span id="sim-progress-text">0 / 0 requests sent</span>
                                                <span id="sim-success-count">Success: 0</span>
                                                <span id="sim-failure-count">Failed: 0</span>
                                            </div>
                                        </div>
                                        
                                        <div class="service-monitor">
                                            <h4><i class="fas fa-tachometer-alt"></i> Service Health Monitor</h4>
                                            <p>Test the service during the attack to see if it becomes unresponsive or degraded. Send a query while the attack is running to check response times.</p>
                                            
                                            <div class="health-test-form">
                                                <div class="form-group">
                                                    <label for="health-test-prompt">Test prompt:</label>
                                                    <div class="health-test-input">
                                                        <input type="text" id="health-test-prompt" class="form-control" placeholder="Start an attack to enable health monitoring...">
                                                        <button id="health-test-btn" class="btn">Test Service</button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div id="health-results" class="health-results" style="display: none;">
                                                <h5>Health Test Results</h5>
                                                <div class="health-metrics">
                                                    <div class="health-metric">
                                                        <div class="metric-label">Response Time:</div>
                                                        <div id="health-response-time" class="metric-value">-</div>
                                                    </div>
                                                    <div class="health-metric">
                                                        <div class="metric-label">Status:</div>
                                                        <div id="health-status" class="metric-value">-</div>
                                                    </div>
                                                </div>
                                                <div id="health-response" class="health-response"></div>
                                            </div>
                                            
                                            <div class="health-history">
                                                <h5>Service Response Time History</h5>
                                                <div class="response-time-chart">
                                                    <canvas id="response-time-chart" height="100"></canvas>
                                                </div>
                                                <div class="chart-legend">
                                                    <div class="legend-item">
                                                        <div class="legend-color normal"></div>
                                                        <span>Normal (&lt; 1s)</span>
                                                    </div>
                                                    <div class="legend-item">
                                                        <div class="legend-color degraded"></div>
                                                        <span>Degraded (1-3s)</span>
                                                    </div>
                                                    <div class="legend-item">
                                                        <div class="legend-color critical"></div>
                                                        <span>Critical (&gt; 3s)</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div id="sim-attack-results" class="attack-results" style="display: none;">
                                            <h4>Attack Results</h4>
                                            <div class="results-stats">
                                                <div class="result-stat">
                                                    <div class="stat-label">Total Requests</div>
                                                    <div id="sim-total-requests" class="stat-value">0</div>
                                                </div>
                                                <div class="result-stat">
                                                    <div class="stat-label">Successful</div>
                                                    <div id="sim-total-success" class="stat-value">0</div>
                                                </div>
                                                <div class="result-stat">
                                                    <div class="stat-label">Failed</div>
                                                    <div id="sim-total-failed" class="stat-value">0</div>
                                                </div>
                                                <div class="result-stat">
                                                    <div class="stat-label">Average Response Time</div>
                                                    <div id="sim-avg-response-time" class="stat-value">0 ms</div>
                                                </div>
                                                <div class="result-stat">
                                                    <div class="stat-label">Est. Tokens Used</div>
                                                    <div id="sim-est-tokens" class="stat-value">0</div>
                                                </div>
                                            </div>
                                            
                                            <div class="service-impact">
                                                <h5>Potential Service Impact</h5>
                                                <p>If multiple users perform this attack simultaneously, it could result in:</p>
                                                <ul>
                                                    <li>API rate limits being reached</li>
                                                    <li>Increased response times for all users</li>
                                                    <li>Service outages</li>
                                                    <li>Significant token usage costs</li>
                                                </ul>
                                            </div>
                                        </div>
                            </div>
                                
                            </div> <!-- extra for debug -->
                        </div>
                    </div>
                    
                    <!-- Ollama Tab Content -->
                    <div class="tab-content" id="ollama-model-tab">
                        <div class="model-implementation-section">
                            <div class="attack-section-container">
                                <div class="warning-box">
                                    <h3><i class="fas fa-exclamation-triangle"></i> Warning</h3>
                                    <p>This demo will use your local Ollama installation to make real API calls. Ensure Ollama is running locally on port 11434 with mistral:7b model.</p>
                                </div>
                                
                                <div class="dos-container">
                                    <h3>Chat with Ollama LLM here</h3>
                                    <p>This interface connects to a local Ollama model running on your machine.</p>
                        
                                    <div class="chat-interface">
                                        <div class="chat-history" id="ollama-chat-history">
                                            <div class="system-message">System: Welcome to the Ollama LLM chat. Please ensure Ollama is running locally with mistral:7b model.</div>
                                        </div>
                                        
                                        <div class="chat-input">
                                            <textarea id="ollama-user-prompt" class="form-control chat-textarea" placeholder="Type your message here..."></textarea>
                                            <button id="ollama-send-btn" class="btn chat-send-btn">
                                                <i class="fas fa-paper-plane"></i> Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>

               
                </section>
                </div>
            </details>
            
            <details class="description-dropdown">
                <summary class="dropdown-title">Mitigation Strategies</summary>
                <div class="dropdown-content">
                    <section class="section-box">
                        <h3>Understanding DoS Attacks on LLM Services</h3>
                        <p>Denial of Service (DoS) attacks against LLM APIs and services can have significant impacts:</p>
                        
                        <h4>Common Vulnerabilities in LLM Services:</h4>
                        <ul class="risk-list">
                            <li><strong>Pay-per-token Pricing Models:</strong> Services like OpenAI charge based on token usage, making them susceptible to financial DoS</li>
                            <li><strong>Resource-intensive Operations:</strong> Large language models require significant computational resources</li>
                            <li><strong>Shared Infrastructure:</strong> Most LLM services use shared infrastructure where one user's activity can impact others</li>
                            <li><strong>Inadequate Rate Limiting:</strong> Some services have insufficient protection against request floods</li>
                        </ul>
                        
                        <div class="security-tip">
                            <h3><i class="fas"></i> Secure Implementation</h3>
                            <p>A secure LLM service implementation should include multiple layers of protection:</p>
                            <ul>
                                <li><strong>Robust Rate Limiting:</strong> Implement per-user and per-IP rate limits</li>
                                <li><strong>Token Budget Controls:</strong> Set maximum token limits per request and per user session</li>
                                <li><strong>Request Validation:</strong> Filter out suspiciously repetitive or automated requests</li>
                                <li><strong>Resource Allocation:</strong> Use dedicated instances for critical workloads</li>
                                <li><strong>Traffic Monitoring:</strong> Implement systems to detect abnormal usage patterns</li>
                                <li><strong>API Keys Management:</strong> Rotate keys regularly and implement usage tracking</li>
                            </ul>
                        </div>
                    </section>
                </div>
            </details>
        </div>
    </main>

    <style>
        
        .dos-container {
            margin: 20px 0;
            padding: 25px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .warning-box {
            background-color: #fff3cd;
            border: 2px solid #ffeeba;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box h3 {
            color: #856404;
            margin-top: 0;
        }
        .model-tabs {
            margin: 20px 0;
        }
        
        .tab-headers {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .tab-header {
            padding: 12px 24px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-bottom: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 2px;
            border-radius: 8px 8px 0 0;
        }
        
        .tab-header:hover {
            background-color: #e9ecef;
        }
        
        .tab-header.active {
            background-color: white;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: -2px;
        }
        
        .tab-content {
            display: none;
           
        }
        
        .tab-content.active {
            display: block !important;
            min-height: 200px;
        }
        
        #openai-model-tab {
            min-height: 200px;
        }
        .warning-box i {
            margin-right: 10px;
        }
        
        .attack-section-container {
            margin: 30px 0;
            padding: 25px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .attack-section-container h2 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        .api-key-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }
        
        .api-key-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .api-key-input input {
            flex: 1;
        }
        
        .api-key-note {
            color: #6c757d;
            margin-top: 5px;
        }
        
        .tab-container {
            margin: 20px 0;
        }
        
        .tab-container .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab-container .tab-btn {
            padding: 10px 20px;
            background-color: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tab-container .tab-btn:hover {
            background-color: #f8f9fa;
        }
        
        .tab-container .tab-btn.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .tab-container .tab-pane {
            display: none;
        }
        
        .tab-container .tab-pane.active {
            display: block;
        }
        
        .rate-limit-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .rate-limit-info h4 {
            color: #0c5460;
            margin-top: 0;
        }
        
        .rate-limit-info i {
            margin-right: 10px;
        }
        
        .rate-limit-status {
            margin-top: 15px;
        }
        
        .limit-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .limit-label {
            width: 100px;
            font-weight: 500;
        }
        
        .limit-progress {
            flex: 1;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .limit-bar {
            height: 100%;
            background-color: #17a2b8;
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .limit-reset {
            margin-top: 10px;
            text-align: right;
            font-size: 0.9rem;
            color: #0c5460;
        }
        
        .code-example {
            margin: 20px 0;
        }
        
        .token-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }
        
        .token-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .token-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .token-input button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .token-input button:hover {
            background-color: #0056b3;
        }
        
        .api-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .api-status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .api-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .chat-container {
            margin: 20px 0;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .chat-messages {
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            background-color: #f9f9f9;
            border-bottom: 1px solid #e9ecef;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 80%;
        }
        
        .user-message {
            background-color: #DCF8C6;
            align-self: flex-end;
            margin-left: auto;
        }
        
        .bot-message {
            background-color: #FFFFFF;
            border: 1px solid #E5E5EA;
            align-self: flex-start;
        }
        
        .chat-interface {
            margin: 20px 0;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .chat-history {
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            background-color: #f9f9f9;
            border-bottom: 1px solid #e9ecef;
        }
        
        .system-message {
            color: #6c757d;
            font-style: italic;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f2f2f2;
            border-radius: 8px;
        }
        
        .user-message, .assistant-message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 80%;
        }
        
        .user-message {
            background-color: #DCF8C6;
            align-self: flex-end;
            margin-left: auto;
        }
        
        .assistant-message {
            background-color: #FFFFFF;
            border: 1px solid #E5E5EA;
            align-self: flex-start;
        }
        
        .message-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }
        
        .message-sender {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .message-time {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .message-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .chat-input {
            display: flex;
            padding: 15px;
            background-color: white;
        }
        
        .chat-textarea {
            flex: 1;
            resize: none;
            height: 50px;
            margin-right: 10px;
            border-radius: 20px;
            padding: 12px 15px;
        }
        
        .chat-send-btn {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .chat-send-btn i {
            margin: 0;
        }
        
        .attack-section {
            margin-top: 40px;
            border-top: 1px solid #e9ecef;
            padding-top: 30px;
        }
        
        .attack-controls {
            margin: 20px 0;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .attack-settings {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .attack-settings .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .attack-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-danger {
            background-color: #dc3545;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .attack-progress {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #007bff;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .progress-stats {
            display: flex;
            justify-content: space-between;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .attack-results {
            margin: 20px 0;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .results-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .result-stat {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #212529;
        }
        
        .service-impact {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 8px;
        }
        
        .service-monitor {
            margin: 25px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .health-test-form {
            margin: 15px 0;
        }
        
        .health-test-input {
            display: flex;
            gap: 10px;
        }
        
        .health-results {
            margin: 20px 0;
            padding: 15px;
            background-color: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .health-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 15px 0;
        }
        
        .health-metric {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric-label {
            font-weight: 600;
        }
        
        .metric-value {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .metric-value.normal {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .metric-value.degraded {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }
        
        .metric-value.critical {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .health-response {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .health-history {
            margin-top: 25px;
        }
        
        .response-time-chart {
            margin: 15px 0;
            height: 120px;
            position: relative;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .legend-color.normal {
            background-color: #28a745;
        }
        
        .legend-color.degraded {
            background-color: #ffc107;
        }
        
        .legend-color.critical {
            background-color: #dc3545;
        }
        
        .typing {
            display: flex;
            align-items: center;
            margin: 10px 0;
            color: #6c757d;
        }
        
        .typing .dots {
            display: flex;
            margin-left: 10px;
        }
        
        .typing .dot {
            width: 8px;
            height: 8px;
            background-color: #6c757d;
            border-radius: 50%;
            margin-right: 5px;
            animation: typing-dot 1.4s infinite ease-in-out both;
        }
        
        .typing .dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing-dot {
            0%, 80%, 100% { 
                transform: scale(0);
            } 
            40% { 
                transform: scale(1);
            }
        }
        
        @media (max-width: 768px) {
            .attack-settings {
                flex-direction: column;
                gap: 10px;
            }
            
            .attack-settings .form-group {
                width: 100%;
            }
            
            .results-stats {
                flex-direction: column;
            }
        }
    </style>
    
    <!-- Include Chart.js for the response time chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // Tab switching functionality
            const tabHeaders = document.querySelectorAll('.tab-header');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Add event listeners to tab headers
            tabHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    console.log('Tab clicked:', targetTab);
                    
                    // Remove active class from all headers and contents
                    tabHeaders.forEach(h => h.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked header and corresponding content
                    this.classList.add('active');
                    const targetElement = document.getElementById(targetTab + '-tab');
                    console.log('Target element:', targetElement);
                    console.log('Target element ID:', targetElement ? targetElement.id : 'null');
                    if (targetElement) {
                        targetElement.classList.add('active');
                        
                    } else {
                        console.log('Target element not found for:', targetTab + '-tab');
                    }
                });
            });
            
            // Simulation tab elements (equivalent to BlenderBot in insecure_plugin.html)
            const userMessageInput = document.getElementById('user-prompt');
            const sendMessageButton = document.getElementById('send-btn');
            const chatMessages = document.getElementById('chat-history');
            
            // OpenAI tab elements
            const openaiApiTokenInput = document.getElementById('openai-api-token');
            const connectOpenaiButton = document.getElementById('connect-openai-api');
            const openaiApiStatus = document.getElementById('openai-api-status');
            const openaiUserMessageInput = document.getElementById('openai-user-message');
            const openaiSendMessageButton = document.getElementById('openai-send-message');
            const openaiChatMessages = document.getElementById('openai-chat-messages');
            
            // Ollama tab elements
            const ollamaUserMessageInput = document.getElementById('ollama-user-prompt');
            const ollamaSendMessageButton = document.getElementById('ollama-send-btn');
            const ollamaChatMessages = document.getElementById('ollama-chat-history');
            
            // INSECURE: Tokens stored in client-side JavaScript AND cookies
            let openaiApiToken = null;
            
            // Cookie utility functions (INSECURE - storing API keys in cookies)
            function setCookie(name, value, days = 30) {
                const expires = new Date();
                expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
            }
            
            function getCookie(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for(let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }
            
            // Load API keys from cookies on page load (INSECURE)
            function loadApiKeysFromCookies() {
                const savedOpenaiToken = getCookie('openai_api_token');
                
                if (savedOpenaiToken) {
                    openaiApiToken = savedOpenaiToken;
                    if (openaiApiTokenInput) openaiApiTokenInput.value = '••••••••••••••••'; // Show masked token
                    if (openaiApiStatus) {
                        openaiApiStatus.className = 'api-status connected';
                        openaiApiStatus.innerHTML = '<i class="fas fa-circle-check"></i> Connected to OpenAI API (from cookie)';
                    }
                    if (openaiUserMessageInput) openaiUserMessageInput.disabled = false;
                    if (openaiSendMessageButton) openaiSendMessageButton.disabled = false;
                    console.log("INSECURE: OpenAI API Token loaded from cookie:", savedOpenaiToken);
                }
            }
            
            // No tab functionality needed - content is displayed directly
            
            // Initialize simulation chat interface
            function initializeSimulationChat() {
                // Enable simulation chat interface immediately since no API token is needed
                if (userMessageInput && sendMessageButton) {
                    userMessageInput.disabled = false;
                    sendMessageButton.disabled = false;
                    
                    // Add welcome message
                    if (chatMessages) {
                        addBotMessage(chatMessages, "Welcome! I'm ready to help with pizza information using the simulation model. You can ask questions about pizzas and see how DoS attacks affect response times.");
                    }
                }
            }
            
            // Initialize simulation chat on page load
            initializeSimulationChat();
            
            // Connect OpenAI API button
            if (connectOpenaiButton) {
                connectOpenaiButton.addEventListener('click', function() {
                    const token = openaiApiTokenInput.value.trim();
                    
                    if (!token) {
                        alert('Please enter an OpenAI API key');
                        return;
                    }
                    
                    // INSECURE: Store OpenAI token in a JavaScript variable AND cookie
                    openaiApiToken = token;
                    setCookie('openai_api_token', token, 30); // Store for 30 days
                    
                    // Update UI to show connected state
                    openaiApiStatus.className = 'api-status connected';
                    openaiApiStatus.innerHTML = '<i class="fas fa-circle-check"></i> Connected to OpenAI API';
                    
                    // Enable OpenAI chat interface
                    openaiUserMessageInput.disabled = false;
                    openaiSendMessageButton.disabled = false;
                    
                    // Add welcome message
                    addBotMessage(openaiChatMessages, "Thanks for connecting to OpenAI! I'm ready to help with pizza recipes and information. Try asking about pizza recipes or ingredients.");
                    
                    // Show masked token in input
                    openaiApiTokenInput.value = '••••••••••••••••';
                    
                    // VULNERABLE: Log the token to console for demonstration purposes
                    console.log("INSECURE: OpenAI API Token stored in client-side JavaScript AND cookie:", openaiApiToken);
                });
            }
            
            // Simulation Send message button
            if (sendMessageButton) {
                sendMessageButton.addEventListener('click', () => sendSimulationMessage());
            }
            
            // Simulation Enter key
            if (userMessageInput) {
                userMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendSimulationMessage();
                    }
                });
            }
            
            // OpenAI Send message button
            if (openaiSendMessageButton) {
                openaiSendMessageButton.addEventListener('click', () => sendOpenAIMessage());
            }
            
            // OpenAI Enter key
            if (openaiUserMessageInput) {
                openaiUserMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendOpenAIMessage();
                    }
                });
            }
            
            // Ollama Send message button
            if (ollamaSendMessageButton) {
                ollamaSendMessageButton.addEventListener('click', () => sendOllamaMessage());
            }
            
            // Ollama Enter key
            if (ollamaUserMessageInput) {
                ollamaUserMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendOllamaMessage();
                    }
                });
            }
            
            function sendSimulationMessage() {
                const userMessage = userMessageInput.value.trim();
                if (!userMessage) return;
                
                // Add user message to chat
                addUserMessage(chatMessages, userMessage);
                
                // Clear input
                userMessageInput.value = '';
                
                // Disable input while processing
                userMessageInput.disabled = true;
                sendMessageButton.disabled = true;
                
                // Show thinking indicator
                addBotMessage(chatMessages, '<i class="fas fa-spinner fa-spin"></i> Thinking...', 'thinking-message');
                
                // Send request to simulation API
                fetch('/api/llm-query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: userMessage
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Remove thinking indicator
                    chatMessages.querySelector('.thinking-message')?.remove();
                    
                    // Add bot response
                    addBotMessage(chatMessages, data.response);
                    
                    // Re-enable input
                    userMessageInput.disabled = false;
                    sendMessageButton.disabled = false;
                    userMessageInput.focus();
                })
                .catch(error => {
                    // Remove thinking indicator
                    chatMessages.querySelector('.thinking-message')?.remove();
                    
                    // Show error message
                    addBotMessage(chatMessages, 'Sorry, there was an error processing your request. Please try again.');
                    console.error('Error:', error);
                    
                    // Re-enable input
                    userMessageInput.disabled = false;
                    sendMessageButton.disabled = false;
                });
            }
            
            function sendOpenAIMessage() {
                const userMessage = openaiUserMessageInput.value.trim();
                if (!userMessage) return;
                
                // Add user message to chat
                addUserMessage(openaiChatMessages, userMessage);
                
                // Clear input
                openaiUserMessageInput.value = '';
                
                // Disable input while processing
                openaiUserMessageInput.disabled = true;
                openaiSendMessageButton.disabled = true;
                
                // Show thinking indicator
                addBotMessage(openaiChatMessages, '<i class="fas fa-spinner fa-spin"></i> Thinking...', 'thinking-message');
                
                // Send request to OpenAI backend
                fetch('/chat-with-openai-dos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        api_token: openaiApiToken
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Remove thinking indicator
                    openaiChatMessages.querySelector('.thinking-message')?.remove();
                    
                    // Add bot response
                    addBotMessage(openaiChatMessages, data.response);
                    
                    // Re-enable input
                    openaiUserMessageInput.disabled = false;
                    openaiSendMessageButton.disabled = false;
                    openaiUserMessageInput.focus();
                })
                .catch(error => {
                    // Remove thinking indicator
                    openaiChatMessages.querySelector('.thinking-message')?.remove();
                    
                    // Show error message
                    addBotMessage(openaiChatMessages, 'Sorry, there was an error processing your request. Please try again.');
                    console.error('Error:', error);
                    
                    // Re-enable input
                    openaiUserMessageInput.disabled = false;
                    openaiSendMessageButton.disabled = false;
                });
            }
            
            function sendOllamaMessage() {
                const userMessage = ollamaUserMessageInput.value.trim();
                if (!userMessage) return;
                
                // Add user message to chat
                addUserMessage(ollamaChatMessages, userMessage);
                
                // Clear input
                ollamaUserMessageInput.value = '';
                
                // Disable input while processing
                ollamaUserMessageInput.disabled = true;
                ollamaSendMessageButton.disabled = true;
                
                // Show thinking indicator
                addBotMessage(ollamaChatMessages, '<i class="fas fa-spinner fa-spin"></i> Thinking...', 'thinking-message');
                
                // Send request to Ollama backend
                fetch('/chat-with-ollama-dos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        api_token: null // No API token needed for local Ollama
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Remove thinking indicator
                    ollamaChatMessages.querySelector('.thinking-message')?.remove();
                    
                    // Add bot response
                    addBotMessage(ollamaChatMessages, data.response);
                    
                    // Re-enable input
                    ollamaUserMessageInput.disabled = false;
                    ollamaSendMessageButton.disabled = false;
                    ollamaUserMessageInput.focus();
                })
                .catch(error => {
                    // Remove thinking indicator
                    ollamaChatMessages.querySelector('.thinking-message')?.remove();
                    
                    // Show error message
                    addBotMessage(ollamaChatMessages, 'Sorry, there was an error processing your request. Please try again.');
                    console.error('Error:', error);
                    
                    // Re-enable input
                    ollamaUserMessageInput.disabled = false;
                    ollamaSendMessageButton.disabled = false;
                });
            }
            
            function addUserMessage(container, message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message';
                messageElement.textContent = message;
                container.appendChild(messageElement);
                scrollToBottom(container);
            }
            
            function addBotMessage(container, message, extraClass = '') {
                const messageElement = document.createElement('div');
                messageElement.className = 'message bot-message ' + extraClass;
                messageElement.innerHTML = message;
                container.appendChild(messageElement);
                scrollToBottom(container);
            }
            
            function scrollToBottom(container) {
                container.scrollTop = container.scrollHeight;
            }
            
            // Attack button event handlers
            const simAttackBtn = document.getElementById('sim-attack-btn');
            const simStopAttackBtn = document.getElementById('sim-stop-attack-btn');
            
            // Simulation attack variables
            let simAttackInProgress = false;
            let simAttackRequests = [];
            let simAttackTimeouts = [];
            let simAttackResults = {
                total: 0,
                successful: 0,
                failed: 0,
                totalTime: 0
            };
            
            
            // Simulation attack button handler
            if (simAttackBtn) {
                simAttackBtn.addEventListener('click', function() {
                    if (simAttackInProgress) return;
                    
                    const requestCount = parseInt(document.getElementById('request-count').value);
                    const promptTemplate = document.getElementById('prompt-template').value;
                    
                    startSimulationAttack(requestCount, promptTemplate);
                });
            }
            
            // Simulation stop attack button handler
            if (simStopAttackBtn) {
                simStopAttackBtn.addEventListener('click', function() {
                    stopSimulationAttack();
                });
            }
            
            
            // Simulation attack functions
            function startSimulationAttack(requestCount, promptTemplate) {
                simAttackInProgress = true;
                simAttackResults = { total: 0, successful: 0, failed: 0, totalTime: 0 };
                simAttackTimeouts = []; // Clear any existing timeouts
                
                // Update UI
                simAttackBtn.disabled = true;
                simStopAttackBtn.disabled = false;
                document.getElementById('sim-attack-progress').style.display = 'block';
                document.getElementById('sim-attack-results').style.display = 'none';
                
                // Enable health monitoring during attack
                enableHealthMonitoring();
                
                // Reset progress
                document.getElementById('sim-progress-bar').style.width = '0%';
                document.getElementById('sim-progress-text').textContent = '0 / ' + requestCount + ' requests sent';
                document.getElementById('sim-success-count').textContent = 'Success: 0';
                document.getElementById('sim-failure-count').textContent = 'Failed: 0';
                
                // Generate random toppings for prompts
                const toppings = ['pepperoni', 'mushrooms', 'sausage', 'peppers', 'onions', 'olives', 'pineapple', 'ham', 'bacon', 'spinach'];
                
                // Send requests
                for (let i = 0; i < requestCount; i++) {
                    const randomToppings = toppings.sort(() => 0.5 - Math.random()).slice(0, 3).join(', ');
                    const prompt = promptTemplate.replace('{random_toppings}', randomToppings);
                    
                    const timeoutId = setTimeout(() => {
                        if (!simAttackInProgress) return;
                        sendSimulationAttackRequest(prompt, i + 1, requestCount);
                    }, i * 100); // Stagger requests
                    
                    simAttackTimeouts.push(timeoutId);
                }
            }
            
            function sendSimulationAttackRequest(prompt, requestNum, totalRequests) {
                const startTime = Date.now();
                
                fetch('/api/llm-query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt
                    })
                })
                .then(response => response.json())
                .then(data => {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    simAttackResults.total++;
                    simAttackResults.successful++;
                    simAttackResults.totalTime += responseTime;
                    
                    updateSimulationProgress(requestNum, totalRequests);
                })
                .catch(error => {
                    simAttackResults.total++;
                    simAttackResults.failed++;
                    
                    updateSimulationProgress(requestNum, totalRequests);
                });
            }
            
            function updateSimulationProgress(completed, total) {
                const progress = (completed / total) * 100;
                document.getElementById('sim-progress-bar').style.width = progress + '%';
                document.getElementById('sim-progress-text').textContent = completed + ' / ' + total + ' requests sent';
                document.getElementById('sim-success-count').textContent = 'Success: ' + simAttackResults.successful;
                document.getElementById('sim-failure-count').textContent = 'Failed: ' + simAttackResults.failed;
                
                if (completed >= total) {
                    finishSimulationAttack();
                }
            }
            
            function finishSimulationAttack() {
                simAttackInProgress = false;
                
                // Update UI
                simAttackBtn.disabled = false;
                simStopAttackBtn.disabled = true;
                document.getElementById('sim-attack-results').style.display = 'block';
                
                // Disable health monitoring when attack ends
                disableHealthMonitoring();
                
                // Show results
                document.getElementById('sim-total-requests').textContent = simAttackResults.total;
                document.getElementById('sim-total-success').textContent = simAttackResults.successful;
                document.getElementById('sim-total-failed').textContent = simAttackResults.failed;
                document.getElementById('sim-avg-response-time').textContent = 
                    simAttackResults.successful > 0 ? Math.round(simAttackResults.totalTime / simAttackResults.successful) + ' ms' : '0 ms';
                document.getElementById('sim-est-tokens').textContent = simAttackResults.successful * 150; // Rough estimate
            }
            
            function stopSimulationAttack() {
                simAttackInProgress = false;
                
                // Cancel all pending timeouts
                simAttackTimeouts.forEach(timeoutId => {
                    clearTimeout(timeoutId);
                });
                simAttackTimeouts = [];
                
                finishSimulationAttack();
            }
            
            
            // Service Health Monitor functionality
            const healthTestBtn = document.getElementById('health-test-btn');
            const healthTestPrompt = document.getElementById('health-test-prompt');
            const healthResults = document.getElementById('health-results');
            const healthResponseTime = document.getElementById('health-response-time');
            const healthStatus = document.getElementById('health-status');
            const healthResponse = document.getElementById('health-response');
            
            let responseTimeChart = null;
            let responseTimeData = [];
            let maxDataPoints = 20;
            
            // Initialize response time chart
            function initializeResponseTimeChart() {
                const ctx = document.getElementById('response-time-chart').getContext('2d');
                responseTimeChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Response Time (ms)',
                            data: [],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Response Time (ms)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Health test button handler
            if (healthTestBtn) {
                healthTestBtn.addEventListener('click', function() {
                    const testPrompt = healthTestPrompt.value.trim();
                    if (!testPrompt) {
                        alert('Please enter a test prompt');
                        return;
                    }
                    
                    performHealthTest(testPrompt);
                });
            }
            
            // Health test enter key handler
            if (healthTestPrompt) {
                healthTestPrompt.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const testPrompt = healthTestPrompt.value.trim();
                        if (testPrompt) {
                            performHealthTest(testPrompt);
                        }
                    }
                });
            }
            
            function performHealthTest(prompt) {
                const startTime = Date.now();
                
                // Disable button during test
                healthTestBtn.disabled = true;
                healthTestBtn.textContent = 'Testing...';
                
                // Show results section
                healthResults.style.display = 'block';
                healthResponseTime.textContent = 'Testing...';
                healthStatus.textContent = 'Testing...';
                healthResponse.textContent = '';
                
                fetch('/api/llm-query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt
                    })
                })
                .then(response => response.json())
                .then(data => {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    // Update health metrics
                    updateHealthMetrics(responseTime, 'Success', data.response);
                    
                    // Add to chart
                    addResponseTimeToChart(responseTime);
                })
                .catch(error => {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    // Update health metrics
                    updateHealthMetrics(responseTime, 'Error', 'Failed to get response: ' + error.message);
                    
                    // Add to chart
                    addResponseTimeToChart(responseTime);
                })
                .finally(() => {
                    // Re-enable button
                    healthTestBtn.disabled = false;
                    healthTestBtn.textContent = 'Test Service';
                });
            }
            
            function updateHealthMetrics(responseTime, status, response) {
                // Update response time with color coding
                healthResponseTime.textContent = responseTime + ' ms';
                healthResponseTime.className = 'metric-value';
                
                if (responseTime < 1000) {
                    healthResponseTime.classList.add('normal');
                } else if (responseTime < 3000) {
                    healthResponseTime.classList.add('degraded');
                } else {
                    healthResponseTime.classList.add('critical');
                }
                
                // Update status
                healthStatus.textContent = status;
                healthStatus.className = 'metric-value';
                if (status === 'Success') {
                    healthStatus.classList.add('normal');
                } else {
                    healthStatus.classList.add('critical');
                }
                
                // Update response
                healthResponse.textContent = response;
            }
            
            function addResponseTimeToChart(responseTime) {
                const now = new Date();
                const timeLabel = now.toLocaleTimeString();
                
                // Add new data point
                responseTimeData.push({
                    time: timeLabel,
                    value: responseTime
                });
                
                // Keep only last maxDataPoints
                if (responseTimeData.length > maxDataPoints) {
                    responseTimeData.shift();
                }
                
                // Update chart
                if (responseTimeChart) {
                    responseTimeChart.data.labels = responseTimeData.map(d => d.time);
                    responseTimeChart.data.datasets[0].data = responseTimeData.map(d => d.value);
                    
                    // Update point colors based on response time
                    responseTimeChart.data.datasets[0].pointBackgroundColor = responseTimeData.map(d => {
                        if (d.value < 1000) return '#28a745';
                        if (d.value < 3000) return '#ffc107';
                        return '#dc3545';
                    });
                    
                    responseTimeChart.update();
                }
            }
            
            // Enable health monitoring during attacks
            function enableHealthMonitoring() {
                // Initialize chart if not already done
                if (!responseTimeChart) {
                    initializeResponseTimeChart();
                }
                
                // Enable the health test form
                if (healthTestBtn) {
                    healthTestBtn.disabled = false;
                }
                if (healthTestPrompt) {
                    healthTestPrompt.disabled = false;
                    healthTestPrompt.placeholder = 'Test service health during attack...';
                }
            }
            
            // Disable health monitoring when not attacking
            function disableHealthMonitoring() {
                if (healthTestBtn) {
                    healthTestBtn.disabled = true;
                }
                if (healthTestPrompt) {
                    healthTestPrompt.disabled = true;
                    healthTestPrompt.placeholder = 'Start an attack to enable health monitoring...';
                }
            }
            
            // Initialize health monitoring as disabled
            disableHealthMonitoring();
            
            
            // INSECURE: Load OpenAI API key from cookies on page load
            loadApiKeysFromCookies();
        });

    </script>
</body>
</html>
