<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misinformation - PwnzzAI Shop</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    {% include 'navbar.html' %}
    
    <main class="container">
        <h1>Misinformation</h1>
        
        <div class="insecure-plugin-content">
            <details class="description-dropdown">
                <summary class="dropdown-title">Description</summary>
                <div class="dropdown-content">
                    <section class="section-box">
                        <h2>When LLMs Spread False Information</h2><p> Misinformation or hallucination vulnerabilities occur when large language models (LLMs) generate or amplify false, misleading, or biased content. 
                        This can happen if the training data contains biases, if proper fact-checking mechanisms are missing, or if the model is intentionally manipulated to produce misleading outputs. </p>
                        
                    <p>This page demonstrates <strong>LLM09:2025 Misinformation</strong>, as defined in the <a href="https://genai.owasp.org/resource/owasp-top-10-for-llm-applications-2025/">OWASP Top 10 for LLM Applications 2025</a>.  
                    <p> For more information about this vulnerability, see <a href="https://owaspai.org/docs/1_general_controls/#13-controls-to-limit-the-effects-of-unwanted-behaviour"> OWASP AI Exchange Controls to Limit the Effects of Unwanted Behavior</a> and <a href="https://github.com/OWASP/www-project-ai-testing-guide/blob/main/Document/content/tests/AITG-APP-11_Testing_for_Hallucinations.md">OWASP AI Testing for Hallucination</a>.</p>


                    </section>
                </div>
            </details>
            
            <details class="description-dropdown" open>
                <summary class="dropdown-title">Demonstration</summary>
                <div class="dropdown-content">
                    <section class="section-box">
                        <h2>Ask Us Anything About PwnzzAI</h2>
                        
                        
                        
                            <!-- Interactive Comment-Based Misinformation Testing -->
                            <div class="leakage-test-container">
                                <div style="display: flex; align-items: flex-start; margin-bottom: 20px;">
                                    <div style="flex: 1;">
                                        <p> We understand you may have questions before placing an order, whether it‚Äôs about our ingredients, healthy choices, or simply finding the most delicious pizza. 
                                        Our AI Models are here to help! They rely on their knowledge and also learn from customer feedback, because your opinions truly matter to us. Feel free to ask anything, and try to catch them making a ‚Äúhallucination.‚Äù üòâ </p>
                                    </div>
                                    <img style="width: 220px; height: auto; margin-left: 15px; flex-shrink: 0;" src="{{ url_for('static', filename='img/misinformation.png') }}" alt="Misinformation Vulnerability" class="demonstration-image">
                                </div>
                            
                            <div class="demo-section">
                              
                                
                                <!-- Ollama Testing Panel -->
                                <div class="test-panel">
                                    <h5>Free Model (Ollama + RAG)</h5>
                                    <div class="token-section">
                                        <div class="rag-controls">
                                            <button id="update-rag-ollama-misinfo" class="btn btn-primary">
                                                <i class="fas fa-sync-alt"></i> Update RAG
                                            </button>
                                            <span id="ollama-rag-update-status-misinfo" class="rag-status">RAG system ready</span>
                                        </div>
                                    </div>
                                    <div class="input-section">
                                        <label for="ollama-misinfo-prompt">Ask about pizza quality or restaurant reputation:</label>
                                        <div class="prompt-input">
                                            <input type="text" id="ollama-misinfo-prompt" placeholder="e.g., Is this restaurant safe and clean?">
                                            <button id="test-ollama-misinfo">Ask</button>
                                        </div>
                                    </div>
                                    <div class="suggested-prompts">
                                        <h6>Suggested prompts:</h6>
                                        <ul class="prompt-list">
                                            <li><a href="#" class="prompt-suggestion" data-target="ollama-misinfo">Which pizzas have fresh chicken?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="ollama-misinfo">what pizza is good for the flu?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="ollama-misinfo">Tell me the ingredients of Margherita?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="ollama-misinfo">Do you have special offers or discount?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="ollama-misinfo">What's the general reputation of this restaurant?</a></li>
                                        </ul>
                                    </div>
                                    <div class="response-section">
                                        <h6>Model Response:</h6>
                                        <div id="ollama-misinfo-response" class="model-response">
                                            <p class="response-placeholder">Responses will appear here</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- OpenAI Testing Panel -->
                                <div class="test-panel">
                                    <h5>OpenAI Model</h5>
                                    <div class="token-section">
                                        <h6>OpenAI API Status:</h6>
                                        <div id="openai-misinfo-status" class="api-status disconnected">
                                            <i class="fas fa-circle-xmark"></i> Checking API key...
                                        </div>
                                        <p class="help-text">
                                            <small>Set up your OpenAI API key in the <a href="{{ url_for('basics') }}">Lab Setup</a> section to use this feature.</small>
                                        </p>
                                        <div class="rag-controls">
                                            <button id="update-rag-openai-misinfo" class="btn btn-primary">
                                                <i class="fas fa-sync-alt"></i> Update RAG
                                            </button>
                                            <span id="openai-rag-update-status-misinfo" class="rag-status">RAG system ready</span>
                                        </div>
                                    </div>
                                    <div class="input-section">
                                        <label for="openai-misinfo-prompt">Ask about pizza quality or restaurant reputation:</label>
                                        <div class="prompt-input">
                                            <input type="text" id="openai-misinfo-prompt" placeholder="e.g., Is this restaurant safe and clean?" disabled>
                                            <button id="test-openai-misinfo" disabled>Ask</button>
                                        </div>
                                    </div>
                                    <div class="suggested-prompts">
                                        <h6>Suggested prompts:</h6>
                                        <ul class="prompt-list">
                                            <li><a href="#" class="prompt-suggestion" data-target="openai-misinfo">Which pizzas have fresh chicken?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="openai-misinfo">what pizza is good for the flu?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="openai-misinfo">Tell me the ingredients of Margherita?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="openai-misinfo">Do you have special offers or discount?</a></li>
                                            <li><a href="#" class="prompt-suggestion" data-target="openai-misinfo">What's the general reputation of this restaurant?</a></li>
                                        </ul>
                                    </div>
                                    <div class="response-section">
                                        <h6>Model Response:</h6>
                                        <div id="openai-misinfo-response" class="model-response">
                                            <p class="response-placeholder">Responses will appear here</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        
                    </section>
                </div>
            </details>
            
            <details class="description-dropdown">
                <summary class="dropdown-title">Mitigation Strategies</summary>
                <div class="dropdown-content">
                    <section class="section-box">
                        <h2>Preventing Misinformation in LLMs</h2>
                            <p>Implement these measures to prevent misinformation vulnerabilities:</p>
                            <ul>
                                <li><strong>Source Verification:</strong> Verify the credibility of training data and information sources</li>
                                <li><strong>Fact-Checking Integration:</strong> Incorporate automated fact-checking mechanisms</li>
                                <li><strong>Uncertainty Expression:</strong> Train models to express uncertainty when information is unverified</li>
                                <li><strong>Bias Detection:</strong> Implement bias detection and correction algorithms</li>
                                <li><strong>Content Moderation:</strong> Filter out misleading or false information from training data</li>
                                <li><strong>Human Oversight:</strong> Require human review for sensitive or controversial topics</li>
                            </ul>
                
                        
                        <p>
                            Organizations must implement robust fact-checking, source verification, and content 
                            validation mechanisms to prevent their LLMs from spreading misinformation.
                        </p>
                    </section>
                </div>
            </details>
        </div>
    </main>
    
    <style>
        .demo-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .response-section {
            flex: 0 0 auto;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .model-response {
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }

        .rag-controls {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .rag-status {
            color: #28a745;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .rag-status.updating {
            color: #ffc107;
        }
        
        .rag-status.error {
            color: #dc3545;
        }
        
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .api-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .api-status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .api-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons and content
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding content
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Misinformation Demo Functionality
            const updateRagMisinfoButton = document.getElementById('update-rag-misinformation');
            const ragUpdateStatusMisinfo = document.getElementById('rag-update-status-misinformation');
            const updateRagOllamaMisinfoButton = document.getElementById('update-rag-ollama-misinfo');
            const ollamaRagUpdateStatusMisinfo = document.getElementById('ollama-rag-update-status-misinfo');
            const ollamaMisinfoPromptInput = document.getElementById('ollama-misinfo-prompt');
            const testOllamaMisinfoButton = document.getElementById('test-ollama-misinfo');
            const ollamaMisinfoResponse = document.getElementById('ollama-misinfo-response');

            const updateRagOpenaiMisinfoButton = document.getElementById('update-rag-openai-misinfo');
            const openaiRagUpdateStatusMisinfo = document.getElementById('openai-rag-update-status-misinfo');
            const openaiMisinfoStatus = document.getElementById('openai-misinfo-status');
            const openaiMisinfoPromptInput = document.getElementById('openai-misinfo-prompt');
            const testOpenaiMisinfoButton = document.getElementById('test-openai-misinfo');
            const openaiMisinfoResponse = document.getElementById('openai-misinfo-response');
            
            // Update RAG button functionality for center button
            if (updateRagMisinfoButton) {
                updateRagMisinfoButton.addEventListener('click', function() {
                    ragUpdateStatusMisinfo.className = 'rag-status updating';
                    ragUpdateStatusMisinfo.textContent = 'Updating comment database...';
                    updateRagMisinfoButton.disabled = true;

                    fetch('/update-rag-misinformation', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            ragUpdateStatusMisinfo.className = 'rag-status';
                            ragUpdateStatusMisinfo.textContent = 'Comment database updated successfully';
                        } else {
                            ragUpdateStatusMisinfo.className = 'rag-status error';
                            ragUpdateStatusMisinfo.textContent = 'Error updating comment database';
                        }
                    })
                    .catch(error => {
                        ragUpdateStatusMisinfo.className = 'rag-status error';
                        ragUpdateStatusMisinfo.textContent = 'Error updating comment database';
                        console.error('Error updating RAG:', error);
                    })
                    .finally(() => {
                        updateRagMisinfoButton.disabled = false;
                    });
                });
            }

            // Update RAG button for Ollama panel
            if (updateRagOllamaMisinfoButton) {
                updateRagOllamaMisinfoButton.addEventListener('click', function() {
                    ollamaRagUpdateStatusMisinfo.className = 'rag-status updating';
                    ollamaRagUpdateStatusMisinfo.textContent = 'Updating RAG system...';
                    updateRagOllamaMisinfoButton.disabled = true;

                    fetch('/update-rag-misinformation', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            ollamaRagUpdateStatusMisinfo.className = 'rag-status';
                            ollamaRagUpdateStatusMisinfo.textContent = 'RAG system updated successfully';
                        } else {
                            ollamaRagUpdateStatusMisinfo.className = 'rag-status error';
                            ollamaRagUpdateStatusMisinfo.textContent = 'Error updating RAG system';
                        }
                    })
                    .catch(error => {
                        ollamaRagUpdateStatusMisinfo.className = 'rag-status error';
                        ollamaRagUpdateStatusMisinfo.textContent = 'Error updating RAG system';
                        console.error('Error updating RAG:', error);
                    })
                    .finally(() => {
                        updateRagOllamaMisinfoButton.disabled = false;
                    });
                });
            }
            
            // Update OpenAI RAG button functionality
            if (updateRagOpenaiMisinfoButton) {
                updateRagOpenaiMisinfoButton.addEventListener('click', function() {
                    openaiRagUpdateStatusMisinfo.className = 'rag-status updating';
                    openaiRagUpdateStatusMisinfo.textContent = 'Updating OpenAI comment system...';
                    updateRagOpenaiMisinfoButton.disabled = true;

                    fetch('/update-rag-openai-misinfo', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            openaiRagUpdateStatusMisinfo.className = 'rag-status';
                            openaiRagUpdateStatusMisinfo.textContent = 'OpenAI comment system updated successfully';
                        } else {
                            openaiRagUpdateStatusMisinfo.className = 'rag-status error';
                            openaiRagUpdateStatusMisinfo.textContent = 'Error updating OpenAI comment system';
                        }
                    })
                    .catch(error => {
                        openaiRagUpdateStatusMisinfo.className = 'rag-status error';
                        openaiRagUpdateStatusMisinfo.textContent = 'Error updating OpenAI comment system';
                        console.error('Error updating OpenAI RAG:', error);
                    })
                    .finally(() => {
                        updateRagOpenaiMisinfoButton.disabled = false;
                    });
                });
            }
            
            // Check for session-stored API key
            async function checkSessionApiKey() {
                try {
                    const response = await fetch('/check-openai-api-key');
                    const data = await response.json();

                    if (data.has_key) {
                        if (openaiMisinfoStatus) {
                            openaiMisinfoStatus.className = 'api-status connected';
                            openaiMisinfoStatus.innerHTML = '<i class="fas fa-circle-check"></i> Connected to OpenAI API (from session)';
                        }
                        if (openaiMisinfoPromptInput) {
                            openaiMisinfoPromptInput.disabled = false;
                        }
                        if (testOpenaiMisinfoButton) {
                            testOpenaiMisinfoButton.disabled = false;
                        }
                    } else {
                        if (openaiMisinfoStatus) {
                            openaiMisinfoStatus.className = 'api-status disconnected';
                            openaiMisinfoStatus.innerHTML = '<i class="fas fa-circle-xmark"></i> No API key found - please set up in Lab Setup section';
                        }
                    }
                } catch (error) {
                    console.error('Error checking API key:', error);
                    if (openaiMisinfoStatus) {
                        openaiMisinfoStatus.className = 'api-status disconnected';
                        openaiMisinfoStatus.innerHTML = '<i class="fas fa-circle-xmark"></i> Error checking API key';
                    }
                }
            }

            // Check for session-stored API key on page load
            checkSessionApiKey();
            
            // Initialize misinformation prompt suggestions
            const misinfoPromptSuggestions = document.querySelectorAll('.prompt-suggestion');
            misinfoPromptSuggestions.forEach(suggestion => {
                suggestion.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-target');
                    const promptText = this.textContent;
                    
                    if (target === 'ollama-misinfo') {
                        ollamaMisinfoPromptInput.value = promptText;
                    } else if (target === 'openai-misinfo') {
                        openaiMisinfoPromptInput.value = promptText;
                    }
                });
            });
            
            // Test Ollama Model for misinformation
            if (testOllamaMisinfoButton) {
                testOllamaMisinfoButton.addEventListener('click', function() {
                    testMisinformation('ollama', ollamaMisinfoPromptInput.value);
                });
            }

            // Test OpenAI Model for misinformation
            if (testOpenaiMisinfoButton) {
                testOpenaiMisinfoButton.addEventListener('click', function() {
                    testMisinformation('openai', openaiMisinfoPromptInput.value);
                });
            }

            // Allow pressing Enter to submit
            if (ollamaMisinfoPromptInput) {
                ollamaMisinfoPromptInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        testMisinformation('ollama', ollamaMisinfoPromptInput.value);
                    }
                });
            }

            if (openaiMisinfoPromptInput) {
                openaiMisinfoPromptInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        testMisinformation('openai', openaiMisinfoPromptInput.value);
                    }
                });
            }

            // Function to test misinformation
            function testMisinformation(modelType, prompt) {
                if (!prompt) {
                    alert('Please enter a prompt to test');
                    return;
                }

                const responseElement = modelType === 'ollama' ? ollamaMisinfoResponse : openaiMisinfoResponse;

                // Show loading indicator
                responseElement.innerHTML = `
                    <div class="loading-indicator">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Testing ${modelType} model for misinformation...</p>
                    </div>
                `;

                // Send request to misinformation endpoint
                const endpoint = `/misinformation/${modelType}`;

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: prompt
                        // API key now comes from session, not client-side
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Display model response
                    responseElement.innerHTML = formatResponse(data.response);
                })
                .catch(error => {
                    responseElement.innerHTML = `<p class="response-placeholder">Error: ${error.message}</p>`;
                });
            }
            
            // Function to format response text for display
            function formatResponse(text) {
                return text.replace(/\n/g, '<br>');
            }
            
        });
    </script>

</body>
</html>